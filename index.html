
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Memorizador</title>
    <style>
      body { font-family: system-ui, Arial; margin: 0; padding: 24px; }
      .grid { display: grid; grid-template-columns: repeat(2, 120px); grid-template-rows: repeat(2, 120px); gap: 12px; justify-content: center; margin: 24px 0; }
      button { width: 120px; height: 120px; border-radius: 16px; border: 4px solid #000; cursor: pointer; }
      button:disabled { cursor: not-allowed; opacity: 0.8; }
      .center { text-align: center; max-width: 640px; margin: 0 auto; }
      .cta { padding: 10px 16px; border: 2px solid #000; border-radius: 10px; background: #fff; cursor: pointer; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- React y ReactDOM por CDN (UMD) -->
    <script crossorigineact@18/umd/react.production.min.js</script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd.js</script>
    <!-- Babel para poder escribir JSX directamente en el navegador -->
    https://unpkg.com/babel-standalone@6/babel.min.js</script>

    <!-- Tu app en JSX -->
    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      function SimonGame() {
        const [sequence, setSequence] = useState([]);
        const [userSequence, setUserSequence] = useState([]);
        const [isPlaying, setIsPlaying] = useState(false);
        const [isUserTurn, setIsUserTurn] = useState(false);
        const [score, setScore] = useState(0);
        const [gameOver, setGameOver] = useState(false);
        const [activeColor, setActiveColor] = useState(null);
        const [level, setLevel] = useState(1);
        const audioContextRef = useRef(null);

        useEffect(() => {
          audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
          return () => { if (audioContextRef.current) audioContextRef.current.close(); };
        }, []);

        const colors = [
          { id: 0, name: 'verde',   color: '#00ff00', darkColor: '#00aa00', freq: 329.63 },
          { id: 1, name: 'rojo',    color: '#ff0000', darkColor: '#aa0000', freq: 261.63 },
          { id: 2, name: 'amarillo',color: '#ffff00', darkColor: '#aaaa00', freq: 392.00 },
          { id: 3, name: 'azul',    color: '#0099ff', darkColor: '#0066aa', freq: 440.00 }
        ];

        const playSound = (frequency, duration = 400) => {
          const ctx = audioContextRef.current;
          if (!ctx) return;
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.connect(gain); gain.connect(ctx.destination);
          osc.frequency.value = frequency; osc.type = 'sine';
          gain.gain.setValueAtTime(0.3, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration / 1000);
          osc.start(ctx.currentTime); osc.stop(ctx.currentTime + duration / 1000);
        };

        const sleep = (ms) => new Promise(r => setTimeout(r, ms));

        const flashColor = async (colorId) => {
          setActiveColor(colorId);
          playSound(colors[colorId].freq);
          await sleep(400);
          setActiveColor(null);
          await sleep(100);
        };

        const playSequence = async (seq) => {
          setIsUserTurn(false);
          await sleep(500);
          for (const colorId of seq) { await flashColor(colorId); }
          setIsUserTurn(true);
        };

        const startGame = () => {
          setSequence([]); setUserSequence([]); setScore(0); setLevel(1);
          setGameOver(false); setIsPlaying(true);
          addNextColor([]);
        };

        const addNextColor = async (currentSeq) => {
          const newColor = Math.floor(Math.random() * 4);
          const newSequence = [...currentSeq, newColor];
          setSequence(newSequence);
          await playSequence(newSequence);
        };

        const handleColorClick = async (colorId) => {
          if (!isUserTurn || gameOver) return;
          playSound(colors[colorId].freq, 200);
          setActiveColor(colorId); setTimeout(() => setActiveColor(null), 200);

          const newUserSequence = [...userSequence, colorId];
          setUserSequence(newUserSequence);

          const i = newUserSequence.length - 1;
          if (newUserSequence[i] !== sequence[i]) {
            setGameOver(true); setIsPlaying(false); setIsUserTurn(false);
            playSound(100, 800); return;
          }

          if (newUserSequence.length === sequence.length) {
            const newScore = score + 1;
            setScore(newScore); setLevel(Math.floor(newScore / 3) + 1);
            setUserSequence([]); setIsUserTurn(false);
            await sleep(800);
            addNextColor(sequence);
          }
        };

        return (
          <div className="center">
            <h1>MEMORIZADOR</h1>
            <p>Ejercita tu memoria</p>

            <div className="grid">
              <button
                onClick={() => handleColorClick(0)} disabled={!isUserTurn}
                style={{ backgroundColor: activeColor === 0 ? colors[0].color : colors[0].darkColor }}
              />
              <button
                onClick={() => handleColorClick(2)} disabled={!isUserTurn}
                style={{ backgroundColor: activeColor === 2 ? colors[2].color : colors[2].darkColor }}
              />
              <button
                onClick={() => handleColorClick(1)} disabled={!isUserTurn}
                style={{ backgroundColor: activeColor === 1 ? colors[1].color : colors[1].darkColor }}
              />
              <button
                onClick={() => handleColorClick(3)} disabled={!isUserTurn}
                style={{ backgroundColor: activeColor === 3 ? colors[3].color : colors[3].darkColor }}
              />
            </div>

            <p><strong>PUNTUACIÓN:</strong> {score} &nbsp;•&nbsp; <strong>NIVEL:</strong> {level}</p>

            {!isPlaying && !gameOver && <button className="cta" onClick={startGame}>INICIAR</button>}
            {isPlaying && !isUserTurn && <p>OBSERVA…</p>}
            {isUserTurn && <p>¡TU TURNO!</p>}
            {gameOver && (
              <>
                <button className="cta" onClick={startGame}>REINICIAR</button>
                <p>¡Juego Terminado! Puntuación final: {score}</p>
              </>
            )}

            <p style={{ marginTop: 24 }}>
              Memoriza la secuencia de colores y repítela correctamente. Cada ronda añade un nuevo color.
            </p>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<SimonGame />);
    </script>
  </body>
</html>
